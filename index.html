<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ジョブコミット事前アンケート</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    /* 全体の背景：画像のような明るいグレーがかった水色 */
    body { 
      font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; 
      margin: 0; 
      padding: 20px 15px;
      background-color: #f0f4f7; 
      color: #333;
    }

    /* コンテナ：画像のバナーの雰囲気に合わせ白ベース */
    .container { 
      max-width: 450px; 
      margin: auto; 
      background: #ffffff; 
      padding: 30px 20px; 
      border-radius: 15px; 
      box-shadow: 0 8px 24px rgba(0,0,0,0.08); 
    }

    /* タイトル：誠実さを出すネイビー系 */
    h2 { 
      text-align: center; 
      color: #004bb1; 
      margin-top: 0;
      margin-bottom: 25px; 
      font-size: 1.4rem;
      letter-spacing: 0.05em;
    }

    .field { margin-bottom: 20px; }

    /* ラベル：視認性を高める */
    label { 
      display: block; 
      font-weight: 600; 
      margin-bottom: 8px; 
      color: #444; 
      font-size: 0.95rem;
    }

    /* 入力フォーム：フォーカス時に青く光るように設定 */
    input, select { 
      width: 100%; 
      padding: 14px; 
      border: 1.5px solid #e0e0e0; 
      border-radius: 8px; 
      box-sizing: border-box; 
      font-size: 16px; 
      transition: border-color 0.2s;
      background-color: #fafafa;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #0056d2;
      background-color: #fff;
    }

    /* 学部・学科の横並び調整 */
    .field-group {
      display: flex; 
      gap: 10px;
    }

    /* 送信ボタン：画像の「友だち追加」ボタンを再現 */
    button { 
      width: 100%; 
      padding: 16px; 
      background: #0056d2; /* ジョブコミットのブランドカラーに合わせた青 */
      color: white; 
      border: none; 
      border-radius: 8px; 
      font-size: 17px; 
      font-weight: bold; 
      cursor: pointer; 
      margin-top: 15px; 
      box-shadow: 0 4px 0 #003d96; /* 立体感 */
      transition: all 0.2s;
    }

    button:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #003d96;
    }

    button:disabled { 
      background: #b0c4de; 
      box-shadow: none;
      cursor: not-allowed; 
    }

    #loading { 
      display: none; 
      text-align: center; 
      margin-top: 20px; 
      color: #0056d2; 
      font-weight: bold; 
      font-size: 0.9rem;
    }

    /* プレースホルダーの色 */
    ::placeholder {
      color: #bbb;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>特別選考フォーム</h2>
  <form id="survey-form">
    <input type="hidden" id="userId" name="userId">

    <div class="field">
      <label>お名前</label>
      <input type="text" id="name" required placeholder="山田 太郎">
    </div>

    <div class="field">
      <label>フリガナ</label>
      <input type="text" id="furigana" required placeholder="ヤマダ タロウ">
    </div>

    <div class="field">
      <label>大学名</label>
      <input type="text" id="university" required placeholder="〇〇大学">
    </div>

    <div class="field">
      <label>学部・学科</label>
      <div style="display: flex; gap: 10px;">
        <input type="text" id="gakubu" placeholder="経済学部" required>
        <input type="text" id="gakka" placeholder="経済学科" required>
      </div>
    </div>

 <div class="field">
      <label>電話番号</label>
      <input type="tel" id="tel" required placeholder="09012345678">
    </div>
    
    <div class="field">
      <label>メールアドレス</label>
      <input type="email" id="email" required placeholder="example@mail.com">
    </div>

   

<div class="field">
  <label>卒業年</label>
  <select id="sotsunen" required autocomplete="off">
    <option value="" selected>選択してください</option>
    <option value="2027">2027卒</option>
    <option value="2026">2026卒</option>
    <option value="2028">2028卒</option>
    <option value="その他">その他</option>
  </select>
</div>

    <button type="button" id="submitBtn" onclick="handleSubmit()">回答を送信する</button>
    <div id="loading">送信中... しばらくお待ちください</div>
  </form>
</div>

<script>
  // ★重要1：最新のGASウェブアプリURL
  const GAS_URL = "https://script.google.com/macros/s/AKfycbwaBCK6fR_OOMFxMdEs9Axh_TLpLk_3tp7jLZKzTYmPJSv5nmA8t8ewwoXSIZ579GA/exec"; 
  // ★重要2：LINE DevelopersのLIFF ID
  const MY_LIFF_ID = "2008904530-lXx8C9i5"; 

  // LIFF初期化
  window.onload = function() {
    liff.init({ liffId: MY_LIFF_ID })
      .then(() => {
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          const context = liff.getContext();
          if (context && context.userId) {
            document.getElementById('userId').value = context.userId;
          }
        }
      })
      .catch((err) => { console.error("LIFF初期化失敗", err); });
  };

  // 送信ボタンクリック時の処理
  async function handleSubmit() {
    const submitBtn = document.getElementById('submitBtn');
    const loading = document.getElementById('loading');
    
    const name = document.getElementById('name').value;
    const userId = document.getElementById('userId').value;
    
    if (!name) { alert("お名前を入力してください"); return; }
    if (!userId) { alert("LINE IDが取得できませんでした。再度開いてください。"); return; }

    submitBtn.disabled = true;
    loading.style.display = "block";

    const data = {
      userId: userId,
      name: name,
      furigana: document.getElementById('furigana').value,
      university: document.getElementById('university').value,
      gakubu: document.getElementById('gakubu').value,
      gakka: document.getElementById('gakka').value,
      email: document.getElementById('email').value,
      tel: document.getElementById('tel').value,
      sotsunen: document.getElementById('sotsunen').value
    };

    try {
      // GASへデータ送信
      await fetch(GAS_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      // LINEにメッセージを自動投稿
      await liff.sendMessages([{
        type: 'text',
        text: 'アンケートの回答を送信しました'
      }]);

      alert("送信完了しました！");
      liff.closeWindow();

    } catch (error) {
      console.error(error);
      alert("通信エラーが発生しました。");
      submitBtn.disabled = false;
      loading.style.display = "none";
    }
  }
</script>

</body>
</html>
